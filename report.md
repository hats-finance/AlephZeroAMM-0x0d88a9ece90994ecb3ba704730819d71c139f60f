# **Introduction to Hats.finance**


    Hats.finance builds autonomous security infrastructure for integration with major DeFi protocols to secure users' assets. 
    It aims to be the decentralized choice for Web3 security, offering proactive security mechanisms like decentralized audit competitions and bug bounties. 
    The protocol facilitates audit competitions to quickly secure smart contracts by having auditors compete, thereby reducing auditing costs and accelerating submissions. 
    This aligns with their mission of fostering a robust, secure, and scalable Web3 ecosystem through decentralized security solutionsâ€‹.

## high

  - **Link**: [Issue #10](https://github.com/hats-finance/AlephZeroAMM-0x0d88a9ece90994ecb3ba704730819d71c139f60f/issues/2090504441)
  - **Preventing users from claiming rewards in the farm contract** - **Summary:** This issue, ranked as high severity, addresses a flaw in the farm contract that allows the contract owner to prevent users from collecting their rewards. This may happen either intentionally or inadvertently when tokens are withdrawn while the farm is inactive. The proposed solution involves revising the 'owner_withdraw_token' function to call 'owner_stop_farm' instead of simply checking '!self.is_active()'. The issue has been confirmed by the project team who open a PR for it based on @0xmahdirostami's findings. Further discussions in the comments reveal some function behavioural specificities and alternative approaches. However, the initial solution is accepted as valid and the issue is acknowledged as a critical one.
  - **Link**: [Issue #20](https://github.com/hats-finance/AlephZeroAMM-0x0d88a9ece90994ecb3ba704730819d71c139f60f/issues/2091267607)
  - **Farm Pool Rewards Vulnerability** - **Summary:** This high severity issue states that despite the protocol assuring users that past rewards cannot be manipulated, the farm pool owner can actually withdraw all tokens. This is possible when the owner creates a pool with multiple reward tokens specified. The issue also includes a detailed attack scenario, Proof of Concept, and recommendations for mitigation. The issue was accepted as VALID with a HIGH severity level by the project team. The mitigation suggested is to not allow duplicate `AccountId`s in the `reward_tokens` vector.
  - **Link**: [Issue #37](https://github.com/hats-finance/AlephZeroAMM-0x0d88a9ece90994ecb3ba704730819d71c139f60f/issues/2094247840)
  - **Excessive Liquidity Withdrawals Due to Protocol Fee Beneficiary Bug** - **Summary:** A high severity issue was identified in the framework contract of hats-finance AlephZeroAMM, which could cause excessive withdrawal of liquidity, affecting not only the paired fees but also a significant chunk of the liquidity added or removed. Under certain circumstances, a large portion of the liquidity could be sent to the protocol fee beneficiary. A user named Bob demonstrated the bug using Rust code as a proof of concept. To resolve this, it was suggested to make changes during the `mint` and `burn` events to use newly updated values. The project team acknowledged the finding and accepted the report as valid.
## low

  - **Link**: [Issue #44](https://github.com/hats-finance/AlephZeroAMM-0x0d88a9ece90994ecb3ba704730819d71c139f60f/issues/2102764453)
  - **Issue: Lower-Than-Expected Rewards Due to Calculation Error** - **Summary:** With the severity marked as high, the issue involves a hidden division carried out before multiplication in the reward calculation for users in a farming token system. This discrepency, highlighted through mathematical demonstrations and repo tests, results in users receiving fewer rewards than intended - e.g. 777 USDC instead of 1000 USDC in a given example scenario. Utilizing a scale factor in the reward rate calculation is the proposed mitigation. However, the project team deemed this a minor issue, awarding it a low severity level. Corrections were made to the error comparisons in the comments clarifying that the error decreases, not increases, with a larger scale factor.
## minor

  - **Link**: [Issue #6](https://github.com/hats-finance/AlephZeroAMM-0x0d88a9ece90994ecb3ba704730819d71c139f60f/issues/2088763058)
  - **Lack of Event Notifications in Crucial Farm Contract Functions** - 
**Summary:** A low severity issue was reported regarding the need for improved transparency in the farm contract. Specifically, the `farm::owner_stop_farm` and `farm::owner_start_new_farm` functions do not currently emit events when actions occur, which is a crucial aspect of user transparency and information. The absence of these events may hinder users' ability to track important changes. Recommendations include additional event definitions and modifying functions to emit these events, thus providing users critical information about the contract's state. While this issue is of minor severity, it was submitted as low due to a minor severity status being unavailable at the time. The project team acknowledged its validity and intends to incorporate the suggested changes.
  - **Link**: [Issue #25](https://github.com/hats-finance/AlephZeroAMM-0x0d88a9ece90994ecb3ba704730819d71c139f60f/issues/2092698405)
  - **Inaccurate Error Message in 'claim_rewards' Function** - **Summary:** A minor severity issue submitted by @0xmahdirostami identified an inaccurate error message in the `farm::claim_rewards` function. The error, `FarmError::CallerNotFarmer`, displayed for users without claimable rewards could lead to wrong assumptions about the caller's status. The submitter proposed replacing it with `FarmError::CallerHasNoClaimableRewards` for more accurate reflection of the situation. The submission has been accepted as valid by the project team.
  - **Link**: [Issue #32](https://github.com/hats-finance/AlephZeroAMM-0x0d88a9ece90994ecb3ba704730819d71c139f60f/issues/2093262685)
  - **Repeated Calls to 'stop_farm' Function Allows Continuous Farming** - **Summary**: A medium severity issue was identified by @rodiontr involving the 'stop_farm' function, which can be called repetitively to keep the farming active. This issue allows the farm 'end' timestamp to be repeatedly updated. Experts have thoroughly reviewed it and confirmed the inconsistency within the contract is valid. However, users' funds are not at risk. The recommendation to resolve this issue is to ensure the farm stops permanently with a new 'block_timestamp' after calling 'stop_farm'.
  - **Link**: [Issue #41](https://github.com/hats-finance/AlephZeroAMM-0x0d88a9ece90994ecb3ba704730819d71c139f60f/issues/2100680396)
  - **Missing Metadata in Pair Contract** - **Summary:** This issue, rated as minor, concerns the absence of proper metadata implementation in the Pair contract. Instead of using a fixed symbol and name for metadata as in the original Uniswap, the current Rust implementation uses default values. This lack of proper metadata can potentially hinder the clarity and interoperability of the Pair contract with other systems. The submitter recommends implementing appropriate values for the symbol and name within the Pair contract to increase compatibility and interoperability. The project team has validated this issue and agrees with the submitter's severity level assignment.
  - **Link**: [Issue #47](https://github.com/hats-finance/AlephZeroAMM-0x0d88a9ece90994ecb3ba704730819d71c139f60f/issues/2104120397)
  - **Restrictions on withdrawing extra tokens in the owner_withdraw_token function** - **Summary:** This medium-severity issue is about a limitation in the `owner_withdraw_token` function within the contract which restricts the owner from withdrawing extra tokens related to the `pool_id`. As a solution, the submitter suggests revised code that removes this restriction and enables the owner to withdraw all extra tokens. However, the project team views this issue as minor severity, considering it a design choice rather than a vulnerability, emphasizing that the `pool_id` is an LP token only intended for farmers to lock for rewards and not for withdrawal. The provided code permits the retrieval of tokens accidentally sent to the wrong contract, ensuring no funds are lost.
