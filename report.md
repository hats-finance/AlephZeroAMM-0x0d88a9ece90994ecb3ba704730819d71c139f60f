**Introduction to Hats.finance**
    Hats.finance builds autonomous security infrastructure for integration with major DeFi protocols to secure users' assets. It aims to be the decentralized choice for Web3 security, offering proactive security mechanisms like decentralized audit competitions and bug bounties. The protocol facilitates audit competitions to quickly secure smart contracts by having auditors compete, thereby reducing auditing costs and accelerating submissions. This aligns with their mission of fostering a robust, secure, and scalable Web3 ecosystem through decentralized security solutionsâ€‹.
    

## high

  - **Link**: [Issue #2090504441](https://github.com/hats-finance/AlephZeroAMM-0x0d88a9ece90994ecb3ba704730819d71c139f60f/issues/2090504441)
  - **User Unable to Claim Granted Rewards Due to Flaw in Farm Contract**      - **Summary:** With high severity, this issue indicates a flaw in the farm contract, which enables the contract owner to unintentionally or intentionally obstruct users from claiming granted rewards. The problem appears when the owner withdraws tokens, while users' pending rewards, expected to be updated in the future, fail to be claimed due to the lack of reward tokens in the contract. The suggested solution is to stop the farm in 'owner_withdraw_token', instead of checking '!self.is_active()'. This adjustment would allow the owner to withdraw all tokens, and halt the farm in case all tokens are withdrawn.
  
  - **Link**: [Issue #2091267607](https://github.com/hats-finance/AlephZeroAMM-0x0d88a9ece90994ecb3ba704730819d71c139f60f/issues/2091267607)
  - **Unauthorized Withdrawal of User Rewards from Farming Pool** 

  - **Summary:** This high-severity issue reported by @coreggon11 concerns a potential exploitation where the owner of a farming pool can take all tokens out from the pool. During the farming process, users deposit `ICE` tokens to get `WOOD` tokens. The protocol presents a loophole where the owner can cease the farm and withdraw users' accumulated rewards, due to a certain condition being executed. A Proof of Concept was provided using a test case. To prevent this, it was recommended that duplicate `AccountId`s in the `reward_tokens` vector should not be allowed. After review, this valid issue and high severity level were accepted.
  - **Link**: [Issue #2094247840](https://github.com/hats-finance/AlephZeroAMM-0x0d88a9ece90994ecb3ba704730819d71c139f60f/issues/2094247840)
  - **Excessive Fees Due to Liquidity Bug in Factory Contract** - **Summary:** The issue, deemed as high severity, highlights a bug that allows not only a piece of the pair fees but also a noticeable part of the liquidity added or removed to be sent to the fee beneficiary. The problem occurs in the circumstance when the 'k_last' value is updated to 'Some(0)', resulting from multiplying members of a local tuple initially equal to '(0, 0)'. A recommended mitigation proposes setting the 'k_last' during 'mint' and 'burn' to the newly updated value. A Proof of Concept coded in Rust was provided. The issue was recognized and confirmed by the project team as valid.
## low

  - **Link**: [Issue #2102764453](https://github.com/hats-finance/AlephZeroAMM-0x0d88a9ece90994ecb3ba704730819d71c139f60f/issues/2102764453)
  - **Incorrect Reward Distribution Due to Reward Rate Calculation Logic** 
  - **Summary:** This high severity issue identified by user @0xmahdirostami concerns the calculation of the reward rate in a farming system. The existing logic involves a division operation before multiplication, leading to a smaller reward rate considering the lack of floating numbers. Consequently, instead of getting a reward of 1000 USDC as the owner intends, users only receive 777 USDC. This issue is evident in the provided test scenario where the owner receives 222 USDC resulting in a discrepancy of around 777600000 USDC meant for users. A proposed mitigation strategy involves applying a scale factor while computing the reward rate in the assert_start_params function. However, the submission was marked as VALID but awarded with LOW severity, with the fault classified as MINOR* due to rule constraints. The project team noted that the identified issue essentially stems from losing reward_rate precision during its initial computation in "assert_start_params."
## minor

  - **Link**: [Issue #2088763058](https://github.com/hats-finance/AlephZeroAMM-0x0d88a9ece90994ecb3ba704730819d71c139f60f/issues/2088763058)
  - **Lack of Event Emission in Farm Start and Stop Functions**  - **Summary:** This low severity issue concerns the lack of events being emitted in the `farm::owner_stop_farm` and `farm::owner_start_new_farm` functions in the farm contract, impacting transparency and user tracking of key changes. It is recommended to introduce `FarmStopped` and `FarmStarted` event definitions and adapt the functions to emit these events. The project team acknowledged the validity of the issue, despite its minor severity, and expressed willingness to accept the recommended changes.
  - **Link**: [Issue #2092698405](https://github.com/hats-finance/AlephZeroAMM-0x0d88a9ece90994ecb3ba704730819d71c139f60f/issues/2092698405)
  - **Misleading Error Message in farm::claim_rewards Function**        - **Summary:** A minor issue where the `farm::claim_rewards` function triggers a `FarmError::CallerNotFarmer` error when a user has no claimable rewards. The error message is not accurate, as the caller could be a farmer but without current rewards. Misinterpretation of the error could lead to false assumptions regarding the caller's status. A revision suggests replacing `FarmError::CallerNotFarmer` with `FarmError::CallerHasNoClaimableRewards` for better accuracy. The project team has accepted and acknowledged the issue.
  - **Link**: [Issue #2093262685](https://github.com/hats-finance/AlephZeroAMM-0x0d88a9ece90994ecb3ba704730819d71c139f60f/issues/2093262685)
  - **Possible Misuse of Function 'stop_farm'** 
  - **Summary:** This GitHub issue, labelled as of medium severity, revolves around the improper usage of the `stop_farm` function, leading to potential security complications. The owner's ability to call this function continually leads to shifting 'end' values pertaining to farm, creating scenarios where the farm isn't properly halted. It also changes the parameters set in `owner_start_new_farm` without restraint. The submitter warned that the farming function could inconveniently reactivate after being stopped. Despite the disagreement in the comment section on the issue's impact on the protocol's security or correctness, it was advised that the `stop_farm` function must ensure the farm is correctly and permanently stopped, and not re-triggered with a new `block_timestamp`. The GitHub team acknowledged that there might be a misunderstanding due to the unnecessary update of the farm's end, causing "informational confusion". The resolution was to accept the issue as valid
  - **Link**: [Issue #2100680396](https://github.com/hats-finance/AlephZeroAMM-0x0d88a9ece90994ecb3ba704730819d71c139f60f/issues/2100680396)
  - **Lack of Metadata Implementation in Pair Contract** - **Summary:** This minor severity issue reports the absence of metadata implementation in the pair contract. The current Rust implementation uses default values instead of a fixed symbol and name for the metadata as in the original Uniswap. This could impact the contract's clarity and interoperability with external systems. The recommended solution is to implement logic for pair metadata by setting appropriate symbol and name values in the Pair contract enhancing its compatibility and interoperability. The issue has been reviewed and marked as valid by the project team.
  - **Link**: [Issue #2104120397](https://github.com/hats-finance/AlephZeroAMM-0x0d88a9ece90994ecb3ba704730819d71c139f60f/issues/2104120397)
  - **Allowing Owner to Withdraw Extra Tokens Associated with the `pool_id`**   
  - **Summary:** This issue falls under the medium severity level and it revolves around a hindrance stoping the owner from withdrawing extra tokens allied with the `pool_id` in the `owner_withdraw_token` function. This restriction prevents the owner from withdrawing additional reward tokens. A revised version of the code was suggested, allowing the owner total freedom to withdraw any token from the contract, including those tied to the `pool_id`. However, the project team views this change as a design choice, rather than a vulnerability, and has assigned it a lower severity level - minor. This design choice allows for the recovery of incorrectly sent tokens (mistakenly) to the contract, without risking loss of current, future, or promised funds.
